app.controller("NewCtrl",["$timeout","$window","$scope","$state","$ionicPopup","$firebaseArray","$firebaseObject","$location","$ionicPopup","NoLogin","saveFood","$stateParams","$ionicLoading","$ionicHistory",function(e,o,t,r,a,n,i,l,a,d,s,c,f,u){d.checkLogin();var p=new Firebase("https://orderfirebase.firebaseio.com/order");f.show({templateUrl:"views/loading.html"});var m=new Firebase("https://orderfirebase.firebaseio.com/foods");c.cat&&(t.listfoods=n(m.orderByChild("cat").equalTo(c.cat))),t.goBack=function(){u.goBack()};var g=s.getFood();console.log(g),t.listfoods&&t.listfoods.$loaded().then(function(e){angular.forEach(e,function(e){angular.forEach(g,function(o){o.name==e.name&&(e.id=!0)})}),f.hide()}),t.order=s.getFoods(),t.addfood=function(e,o,r){if(s.getFood()?t.order.food=s.getFood():t.order.food=[],e){t.amount={},t.amount.count=1;var n,i=a.show({template:'<input type="number" ng-model="amount.count" class="input">',title:"ระบุจำนวนสั่ง",scope:t,buttons:[{text:"ยกเลิก"},{text:"<b>ตกลง</b>",type:"button-positive",onTap:function(e){n=t.amount.count}}]});i.then(function(e){t.order.food.push({name:o,price:r,amount:n})})}else{var l=t.order.food.indexOf(o);t.order.food.splice(l,1)}s.setFood(t.order.food)},t.add=function(){if(t.order.table=s.getTable(),0!=t.order.table&&0!=s.getFood().length){t.order=s.getFoods();var o="",r=1,i=0;angular.forEach(t.order.food,function(e){if(o=o+r+". "+e.name+"<br/>",r+=1,e.amount>1){var t=parseInt(e.price)*parseInt(e.amount);i+=t}else i+=parseInt(e.price)});var d=a.confirm({title:"รายการสั่ง",subTitle:"โต๊ะ: "+t.order.table+" ราคารวม: "+i+" บาท",template:o});d.then(function(r){if(r){var i=new Firebase("https://orderfirebase.firebaseio.com/member"),d=n(i);d.$loaded().then(function(e){angular.forEach(e,function(o,r){if(p.getAuth().password.email==e[r].email){t.order.fullname=e[r].name.toString()+" "+e[r].lastname.toString();var a=p.push(),n=a.key();t.order.id=n,a.set(t.order)}})});a.alert({title:"SUCCESS",template:"สั่งอาหารเรียบร้อย"});e(function(){t.order={},s.setFoods(t.order),s.setFood([]),s.setTable(0),l.path("/chooseTable")},1e3)}else console.log("ยกเลิก"),o=""})}else if(null==t.order.table&&0==t.order.food.length){a.alert({title:"NOTICE",template:"โปรดใส่เลขโต๊ะ และ เลือกอาหาร"})}else if(0==s.getFood().length){a.alert({title:"NOTICE",template:"โปรดเลือกอาหาร"})}else if(s.getTable())console.log("Error");else{a.alert({title:"NOTICE",template:"โปรดใส่เลขโต๊ะ"})}}}]);